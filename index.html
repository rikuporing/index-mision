<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[CONSOLIDADO] Dossier, Terminal V y Bestiario</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Terminal Green (Consistent across all sections) -->
    <!-- Application Structure Plan: Start on Dossier 1. Two persistent buttons navigate to Terminal V or Bestiary. Each sub-section has a return button. This creates a main hub with explorable branches. -->
    <!-- Visualization & Content Choices: Dossier: date puzzle. Terminal V: numeric sequence to glitched binary. Bestiary: grid-to-modal clan browser. JS handles all visibility, validation, and effects. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: #0a0a0a;
            color: #00ff41;
            text-shadow: 0 0 5px #00ff41, 0 0 10px #00ff41;
        }
        .terminal-container-bg { 
            position: fixed; 
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden; 
            z-index: -1; 
        }
        .terminal-container-bg::before { /* Scanlines */
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%);
            background-size: 100% 4px;
            pointer-events: none;
            animation: scan 7.5s linear infinite;
        }
        .terminal-container-bg::after { /* Flicker sutil */
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(18,16,16,0.05);
            opacity: 0;
            animation: flicker 0.18s infinite steps(1, end);
            pointer-events: none;
        }
        @keyframes scan {
            0% { background-position: 0 0; }
            100% { background-position: 0 100vh; }
        }
        @keyframes flicker {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.2; }
        }
        .content-wrapper { 
            border: 2px solid #00ff41;
            box-shadow: 0 0 15px #00ff41;
            padding: 1.5rem;
            width: 100%;
            max-width: 900px;
            background-color: rgba(0, 10, 0, 0.85); 
            position: relative; 
            z-index: 10; 
            margin: 2rem auto;
        }
        .hidden-section {
            display: none !important;
        }

        /* Input Styles */
        .input-field, .date-char-input { 
            background-color: #051805;
            border: 1px solid #00ff41;
            color: #00ff41;
            text-shadow: 0 0 3px #00ff41;
        }
        .input-field::placeholder { color: #009927; opacity: 0.7; }
        .date-char-input { 
            width: 2.2rem; height: 2.8rem; text-align: center; font-size: 1.25rem; 
            padding: 0.25rem; caret-color: #00ff41; -moz-appearance: textfield;
        }
        .date-char-input::-webkit-outer-spin-button,
        .date-char-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .date-char-input:focus { outline: 1px solid #00ff41; box-shadow: 0 0 8px #00ff41; }

        /* Button Styles */
        .action-button {
            border: 1px solid #00ff41; color: #00ff41; background-color: transparent;
            padding: 0.5rem 1rem; text-shadow: inherit; transition: all 0.3s ease; margin-top: 0.75rem; 
        }
        .action-button:hover:not(:disabled) { background-color: #00ff41; color: #0a0a0a; text-shadow: none; }
        .action-button:disabled { opacity: 0.5; cursor: not-allowed; }
        .navigation-button { 
            background-color: #005c1f; border-color: #00ff41; color: #ccffdd;
            margin-top: 1rem; padding: 0.75rem 1.5rem; font-size: 1.1rem; width: 100%; display: block;
        }
        .navigation-button:hover:not(:disabled) { background-color: #00ff41; color: #0a0a0a; }

        /* Details & Countdown */
        #mission-details-container { display: none; opacity: 0; transition: opacity 0.5s ease-in-out; }
        #mission-details-container.visible { display: block; opacity: 1; }
        .countdown-digits { letter-spacing: 0.05em; }

        /* Binary Output & Glitch */
        #binary-output-container { display: none; border: 1px dashed #00cc33; padding: 1rem; margin-top: 1rem; background-color: rgba(0,0,0,0.3); max-height: 250px; overflow-y: auto; position: relative; }
        #binary-output-container.glitch-active-area { border-color: #FF3333; background-color: rgba(0,0,0,0.5); }
        #binary-output-container.glitch-active-area #binary-code-content { opacity: 0.6; color: #009920; position: relative; z-index: 0; }
        #binary-output-container.glitch-active-area #binary-output-title { animation: glitch-color-text-anim 0.5s infinite linear alternate; position: relative; z-index: 5; }
        .glitch-active-area::before, .glitch-active-area::after { content: 'ERR_DATA_CORRUPTION // SYS_FAULT\AUNSTABLE_SIGNAL // PLZ_RETRY\A0xDEADBEEF // KERNEL_PANIC\A##### // FRAGMENTED_DATA'; position: absolute; top: 0; left: 0; width: 100%; height: 100%; font-size: 1em; opacity: 0; pointer-events: none; z-index: 10; white-space: pre-wrap; overflow: hidden; line-height: 1.2; padding: 0.5rem; box-sizing: border-box; font-family: 'Share Tech Mono', monospace; }
        .glitch-active-area::before { color: #FF3333; text-shadow: 1px 0px 0px #00FFFF, -1px 0px 0px #FF00FF; animation: glitch-text-anim-complex 0.1s infinite steps(2, jump-none) alternate, glitch-opacity-fadein 0.5s forwards; }
        .glitch-active-area::after { content: 'ACCESS_DENIED_OVERRIDE\AATTEMPTING_RECOVERY // ...FAIL\AREBOOT_SEQUENCE_INITIATED_ERR'; color: #00FF00; text-shadow: 1px 0px 0px #FF00FF, -1px 0px 0px #00FFFF; animation: glitch-text-anim-complex 0.15s infinite steps(3, jump-none) alternate-reverse, glitch-opacity-fadein 0.7s forwards 0.2s; z-index: 11; }
        @keyframes glitch-opacity-fadein { from { opacity: 0; } to { opacity: 0.15; } }
        @keyframes glitch-text-anim-complex { 0% { clip-path: inset(15% 0% 70% 0%); transform: translate(-3px, 2px); } 10% { clip-path: inset(80% 0% 5% 0%); transform: translate(4px, -3px); } 20% { clip-path: inset(5% 0% 85% 0%); transform: translate(-2px, -2px); } 30% { clip-path: inset(60% 0% 20% 0%); transform: translate(3px, 4px); } 40% { clip-path: inset(25% 0% 50% 0%); transform: translate(-4px, 1px); } 50% { clip-path: inset(75% 0% 10% 0%); transform: translate(2px, -4px); } 60% { clip-path: inset(10% 0% 65% 0%); transform: translate(-1px, 3px); } 70% { clip-path: inset(50% 0% 30% 0%); transform: translate(4px, -1px); } 80% { clip-path: inset(90% 0% 2% 0%); transform: translate(-3px, -3px); } 90% { clip-path: inset(20% 0% 75% 0%); transform: translate(1px, 2px); } 100% { clip-path: inset(45% 0% 45% 0%); transform: translate(0px, 0px); } }
        @keyframes glitch-color-text-anim { 0% { color: #ffff00; text-shadow: 0 0 3px #ffff00;} 25% { color: #ff9900; text-shadow: 0 0 3px #ff9900;} 50% { color: #ff3300; text-shadow: 0 0 5px #ff3300;} 75% { color: #cc0000; text-shadow: 0 0 5px #cc0000;} 100% { color: #ff00ff; text-shadow: 0 0 3px #ff00ff;} }
        .input-error-glitch { animation: input-glitch-animation 0.25s infinite alternate; color: #ff3333; text-shadow: 1px 1px #00ffff, -1px -1px #ff00ff; }
        @keyframes input-glitch-animation { 0% { transform: translate(1px, -1px); } 25% { transform: translate(-1px, 1px); } 50% { transform: translate(1px, 1px); } 75% { transform: translate(-1px, -1px); } 100% { transform: translate(0px, 0px); } }
        
        /* Bestiary Styles */
        .clan-grid-item { border: 1px solid #00802B; padding: 1.5rem 1rem; text-align: center; cursor: pointer; transition: all 0.2s ease-in-out; background-color: rgba(0, 20, 0, 0.5); }
        .clan-grid-item:hover { background-color: #00ff41; color: #0a0a0a; text-shadow: none; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0, 255, 65, 0.4); }
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-close-btn { transition: all 0.2s ease-in-out; }
        .modal-close-btn:hover { color: #ff3333; transform: rotate(90deg); }
        .lore-section { margin-bottom: 1.25rem; }
        .discipline-btn { display: inline-block; background-color: transparent; border: 1px solid #00802B; padding: 0.25rem 0.75rem; margin: 0.25rem; border-radius: 4px; cursor: pointer; transition: all 0.2s ease; }
        .discipline-btn:hover { background-color: #00802B; color: #ccffdd; }
        #discipline-tooltip { display: none; position: absolute; background-color: #0a0a0a; border: 1px solid #00ff41; padding: 0.75rem; border-radius: 4px; box-shadow: 0 0 10px #00ff41; max-width: 300px; z-index: 110; }
        .date-input-group { display: flex; align-items: center; justify-content: center; gap: 0.35rem; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="terminal-container-bg"></div> 

    <div id="dossier-wrapper" class="content-wrapper dossier-container"> 
        <header class="text-center mb-6">
            <h1 class="text-2xl md:text-4xl font-bold">[ DOSSIER: DILUVIO ESCARLATA ]</h1>
            <p class="text-sm">ACCESO CONCEDIDO: USUARIO_██████</p>
            <div class="w-full h-px bg-green-400 my-3"></div>
        </header>

        <main id="dossier-main-content" class="space-y-8">
            <section id="prelude-text-container">
                <h2 class="text-xl font-bold mb-3 text-center">[INICIO DE TRANSMISIÓN // ALERTA GLOBAL]</h2>
                <div id="prelude-text" class="space-y-4">
                    <p class="mb-4">El día en que el cielo se rompió, la lluvia comenzó y simplemente… no paró.</p>
                    <p class="mb-4">Al principio, la gente culpó a la temporada de huracanes, inusualmente violenta. Otros, con voz temblorosa, susurraban que era el cambio climático desatado, la antesala del fin del mundo. Nosotros, la gente de la noche, no teníamos respuestas certeras, solo un presentimiento helado que recorría la sangre estancada en nuestras venas.</p>
                    <p class="mb-4">Semanas. Semanas de un aguacero implacable, un llanto constante del cielo.</p>
                    <p class="mb-4">Fue entonces cuando los más viejos, aquellos que aún recuerdan los ecos de otros eones, comenzaron a murmurar el nombre prohibido, la oscura profecía:</p>
                    <p class="text-center text-2xl my-6 animate-pulse block">"—Son las Lágrimas de Kain…"</p>
                    <p class="mb-4">Esto no era una simple tormenta. Era un diluvio. Un castigo divino o infernal, ¿quién podría decirlo?</p>
                </div>
            </section>

            <div class="w-full h-px bg-green-400 my-6"></div>

            <section id="transcript-section">
                 <h2 class="text-xl font-bold mb-1 text-center">[DECRYPTION: ARCHIVO_CEM_DEAA_GAMMA_7.LOG]</h2>
                <p class="text-xs text-center mb-1"><strong class="text-cyan-500">[CONFIDENCIAL – ARCHIVO INTERNO CLASIFICADO]</strong></p>
                <p class="text-xs text-center mb-1">CONFERENCIA DEL EPISCOPADO MEXICANO</p>
                <p class="text-xs text-center mb-4">Departamento de Exorcismos y Asuntos Anómalos (DEAA)</p>
                
                <div class="border border-green-500 p-4 space-y-3 bg-black bg-opacity-30">
                    <p><strong class="text-cyan-400">REGISTRO DE INTERROGATORIO – SECCIÓN GAMMA</strong></p>
                    <p><strong class="text-cyan-400">IDENTIFICACIÓN DEL SUJETO:</strong> █████████████ (Amenaza Sobrenatural Activa – Nivel Escarlata)</p>
                    <p><strong class="text-cyan-400">FECHA DE REGISTRO:</strong> 5 de Siván, 5785</p>
                    <p><strong class="text-cyan-400">HORA DE INICIO:</strong> 00:30 hrs.</p>
                    <p><strong class="text-cyan-400">UBICACIÓN:</strong> Sala de Contención Segura VII, Instalación Subterránea "Arcángel Miguel".</p>
                    <br>
                    <p class="text-xs italic text-gray-500">(Inicio de la grabación de audio. Ambiente metálico y frío.)</p>
                    <p><strong class="text-yellow-300">LA VOZ DEL INTERROGADOR (áspera, cargada de autoridad y hastío):</strong> Entonces, abominación… ilumíname. ¿Qué carajo está planeando tu gente? ¿Por qué esta lluvia de mierda no cesa? ¡Habla de una vez!</p>
                    <p class="text-red-500 text-sm italic">[Un sonido sordo y húmedo interrumpe el silencio. El impacto brutal de un puño contra carne resistente.]</p>
                    <p><strong class="text-gray-400">LA VOZ DEL PRISIONERO (gutural, con un matiz de oscura diversión):</strong> Ugh… Ya te lo dije, hombre de la tela… no sé un carajo. Y, por favor, ¿podrías dejar de aporrearme con tus delicados nudillos? En realidad… solo me haces cosquillas. Je, je.</p>
                    <p><strong class="text-yellow-300">LA VOZ DEL INTERROGADOR:</strong> ¿Cosquillas, eh? Veremos si esto te provoca alguna gracia. ¿Cuál era la misión de tus amiguitos? Para esta hora, ya deben estar ardiendo y chillando en las llamas del infierno que tanto predicamos. Dímelo.</p>
                    <p><strong class="text-gray-400">LA VOZ DEL PRISIONERO (una risa seca, como piedras raspándose):</strong> ¡JA! ¿Ellos? Simples peones, estorbos glorificados. Si no fuera por su monumental incompetencia, no estaría aquí, disfrutando de tu… exquisita hospitalidad. ¡Sarta de pendejos!</p>
                    <p class="text-red-500 text-sm italic">[Otro golpe, este más crujiente, seguido de un gruñido ahogado del prisionero, esta vez con un atisbo de dolor.]</p>
                    <p><strong class="text-gray-400">LA VOZ DEL PRISIONERO:</strong> Okay… eso sí ardió un poco, ¿sabes? Pero puedes seguir golpeándome una y otra vez… Ya te dije todo lo que sé. No hay más en el puto menú.</p>
                    <p class="text-red-500 text-sm italic">[Un sonido agudo y restallante. Una bofetada que hace eco en la sala.]</p>
                    <p><strong class="text-yellow-300">LA VOZ DEL INTERROGADOR (siseando con impaciencia):</strong> *Tú* me dirás todo lo que *yo* necesito saber. Sabemos que la Camarilla ha enviado varias tropas de vampiros jóvenes, neófitos, a diversos puntos de esta ciudad maldita. Los ancianos de tu clan, o lo que quede de ellos, creen que este diluvio es obra de un ser muy poderoso. El principio del fin, como balbucean los locos en los mercados inundados. Mi tropa, la que interceptó a tus… colegas, se dirigía a Tecámac. Hay una iglesia olvidada allí, y dentro, una reliquia que, según nuestras fuentes, posiblemente sea la clave para evitar este jodido apocalipsis.</p>
                    <p><strong class="text-gray-400">LA VOZ DEL PRISIONERO (suelta un suspiro que suena casi teatral, resignado):</strong> Sí, sí… Tecámac, la reliquia, el fin del mundo como lo conocemos… la misma cantaleta. Hay varios puntos de interés para la Camarilla, es cierto. Pero si te digo algo, acá entre nos, y que conste en tu mugrosa acta… yo siempre creí que todo este puto desmadre venía del Tlalocatépetl. Pero claro, nadie me quiso hacer caso. Los "estrategas" siempre saben más, ¿no? En fin, eso es todo lo que tengo para ti. Es todo el botín.</p>
                    <p><strong class="text-yellow-300">LA VOZ DEL INTERROGADOR (con una calma gélida que eriza la piel):</strong> No aportas nada nuevo. Es exactamente lo mismo que nos dijeron tus compañeros antes de… expirar. Eres una pérdida de tiempo y recursos.</p>
                    <p class="text-red-500 text-sm italic">[Se escuchan pasos firmes que se acercan. Luego, el chirrido metálico de un mecanismo pesado.]</p>
                    <p><strong class="text-yellow-300">LA VOZ DEL INTERROGADOR:</strong> Este ya no nos sirve. Abran el ventanal. Que le dé un poco el sol.</p>
                    <p><strong class="text-gray-400">LA VOZ DEL PRISIONERO (un grito gutural, una mezcla espeluznante de terror puro y rabia impotente, que se corta abruptamente con un siseo violento y un silencio repentino y absoluto):</strong> ¡NOOOO…! ¡ARRRGH…!</p>
                    <p class="text-xs italic text-gray-500">(Fin de la grabación.)</p>
                </div>
            </section>

            <div class="w-full h-px bg-green-400 my-6"></div>

            <section id="dossier-date-reveal-section" class="text-center p-6 border border-green-500 bg-black bg-opacity-30">
                <h2 class="text-xl font-bold mb-2">[CONVERGENCIA TEMPORAL INMINENTE]</h2>
                <p class="text-base text-red-300 mb-1">Tiempo restante hasta el evento "Observación Primaria":</p>
                <div id="puzzle-countdown-timer" class="text-4xl md:text-5xl font-bold text-red-400 p-3 mb-6 countdown-digits">
                    <span id="dossier-hours">00</span>:<span id="dossier-minutes">00</span>:<span id="dossier-seconds">00</span>
                </div>
                <p class="mb-4">Ingrese el código de acceso temporal para decodificar datos de misión:</p>
                <div class="flex flex-col sm:flex-row justify-center items-center gap-3">
                    <input type="text" id="dossier-access-code-input" class="input-field p-2 w-full sm:w-auto flex-grow" placeholder="Ingresar código de acceso">
                    <button id="dossier-verify-code-btn" class="action-button px-6 py-2 w-full sm:w-auto">VERIFICAR</button>
                </div>
                <div id="dossier-error-message-container" class="h-5 mt-2">
                    <p id="dossier-error-message" class="text-red-500" role="alert" aria-live="assertive"></p>
                </div>
                <div id="mission-details-container"> 
                    <h3 class="text-2xl font-bold text-yellow-300 mt-6 mb-2">[PROTOCOLO DE MISIÓN ACTIVADO]</h3>
                    <p class="text-lg text-yellow-200">Nombre de la Operación:</p>
                    <p id="mission-name" class="text-3xl font-bold text-yellow-300 py-2">Cielos Quebrados, Heridas Abiertas</p>
                    <p class="text-lg text-yellow-200 mt-3">Fecha de Inicio de Misión:</p>
                    <p id="mission-start-date" class="text-3xl font-bold text-yellow-300 py-2">28 de Junio de 2025</p>
                </div>
            </section>
            <div class="w-full h-px bg-green-400 my-6"></div>
            <footer class="text-center mt-8">
                 <button id="proceed-to-terminal-v-btn" class="action-button navigation-button">
                    [ACCEDER A INTERFAZ DE DATOS V &gt;&gt;]
                </button>
                 <button id="proceed-to-bestiary-btn" class="action-button navigation-button">
                    [ABRIR BESTIARIO DE CLANES &gt;&gt;]
                </button>
            </footer>
        </main>
    </div>

    <div id="terminal-v-wrapper" class="content-wrapper hidden-section"> 
        <header class="text-center mb-6">
            <h1 class="text-2xl md:text-3xl font-bold">[TERMINAL DE DATOS V // PROTOCOLO DE ACCESO RESTRINGIDO]</h1>
            <div class="w-full h-px bg-green-400 my-3"></div>
        </header>
        <main id="terminal-v-main-content" class="space-y-6">
            <section id="terminal-v-date-input-section" class="text-center">
                <p class="mb-3 text-yellow-300">&gt; INGRESE SECUENCIA NUMÉRICA DE REGISTRO INICIO</p>
                <div id="terminal-v-date-casillas-container" class="flex flex-wrap items-center justify-center gap-x-2 gap-y-2 mb-3"> 
                    <div class="date-input-group" id="numeric-date-inputs">
                        <input type="number" maxlength="1" class="date-char-input" aria-label="Dígito 1">
                        <input type="number" maxlength="1" class="date-char-input" aria-label="Dígito 2">
                        <input type="number" maxlength="1" class="date-char-input" aria-label="Dígito 3">
                        <input type="number" maxlength="1" class="date-char-input" aria-label="Dígito 4">
                        <input type="number" maxlength="1" class="date-char-input" aria-label="Dígito 5">
                        <input type="number" maxlength="1" class="date-char-input" aria-label="Dígito 6">
                        <input type="number" maxlength="1" class="date-char-input" aria-label="Dígito 7">
                        <input type="number" maxlength="1" class="date-char-input" aria-label="Dígito 8">
                    </div>
                </div>
                <button id="terminal-v-verify-date-btn" class="action-button">DECODIFICAR TRANSMISIÓN</button>
                <div id="terminal-v-message-feedback-container" class="h-6 mt-2">
                    <p id="terminal-v-message-feedback" class="text-red-500" role="alert" aria-live="assertive"></p>
                </div>
            </section>
            <section id="binary-output-container"> 
                <h2 id="binary-output-title" class="text-xl font-bold text-yellow-300 mb-2">[INICIO DE TRANSMISIÓN // REGISTRO 02 T]</h2>
                <pre id="binary-code-content" class="text-sm whitespace-pre-wrap leading-relaxed"></pre> 
            </section>
        </main>
        <footer class="text-center mt-8 pt-4 border-t border-green-600">
             <button id="return-to-dossier-btn" class="action-button navigation-button">
                [&lt;&lt; VOLVER AL DOSSIER PRINCIPAL]
            </button>
        </footer>
    </div>

    <div id="bestiary-wrapper" class="content-wrapper hidden-section"> 
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold">[ B E S T I A R I O ]</h1>
            <p class="text-lg text-yellow-300">REGISTROS CLASIFICADOS DE CLANES VÁSTAGOS</p>
            <div class="w-1/2 h-px bg-green-400 my-3 mx-auto"></div>
        </header>
        <main>
            <div id="clan-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            </div>
        </main>
        <footer class="text-center mt-12 pt-6 border-t-2 border-dashed border-green-700">
             <button id="return-to-dossier-from-bestiary-btn" class="action-button navigation-button">
                [&lt;&lt; VOLVER AL DOSSIER PRINCIPAL]
            </button>
            <p class="text-lg accent-text mt-4">Cualquier avistamiento de estas criaturas comunicarse con su Danger Manager.</p>
        </footer>
    </div>

    <div id="clan-modal" class="modal">
        <div class="content-wrapper modal-content w-11/12 max-w-3xl max-h-[90vh] flex flex-col">
            <header class="flex justify-between items-center pb-3 border-b border-green-700 mb-4 flex-shrink-0">
                <h2 id="modal-clan-name" class="text-3xl font-bold"></h2>
                <button id="modal-close-btn" class="text-4xl font-bold modal-close-btn">&times;</button>
            </header>
            <div class="overflow-y-auto pr-2">
                <section class="lore-section">
                    <h3 class="text-xl font-bold text-yellow-300 mb-2">APODO</h3>
                    <p id="modal-clan-nickname" class="text-base"></p>
                </section>
                <div class="w-full h-px bg-green-700 my-4"></div>
                <section class="lore-section">
                    <h3 class="text-xl font-bold text-yellow-300 mb-2">TRASFONDO AMPLIADO</h3>
                    <p id="modal-clan-background" class="text-base"></p>
                </section>
                <div class="w-full h-px bg-green-700 my-4"></div>
                <section class="lore-section">
                    <h3 class="text-xl font-bold text-yellow-300 mb-2">PUNTOS DE AVISTAMIENTO</h3>
                    <p id="modal-clan-sighting-points" class="text-base"></p>
                </section>
                <div class="w-full h-px bg-green-700 my-4"></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6">
                    <div class="lore-section">
                        <h3 class="text-xl font-bold text-yellow-300 mb-2">APARIENCIA</h3>
                        <p id="modal-clan-appearance" class="text-base"></p>
                    </div>
                    <div class="lore-section">
                        <h3 class="text-xl font-bold text-yellow-300 mb-2">ORGANIZACIÓN</h3>
                        <p id="modal-clan-organization" class="text-base"></p>
                    </div>
                </div>
                <div class="w-full h-px bg-green-700 my-4"></div>
                <section class="lore-section">
                    <h3 class="text-xl font-bold text-yellow-300 mb-2">DISCIPLINAS DE CLAN</h3>
                    <div id="modal-clan-disciplines" class="flex flex-wrap gap-2"></div>
                </section>
                <div class="w-full h-px bg-green-700 my-4"></div>
                <section class="lore-section">
                    <h3 class="text-xl font-bold text-yellow-300 mb-2">DEFECTO</h3>
                    <p id="modal-clan-weakness" class="text-base"></p>
                </section>
            </div>
        </div>
    </div>
    <div id="discipline-tooltip"></div>
    
    <audio id="sound-click" src="https://cdn.jsdelivr.net/gh/ManzDev/cursos-assets/js/js-sound-click.mp3" preload="auto"></audio>
    <audio id="sound-success" src="https://cdn.jsdelivr.net/gh/ManzDev/cursos-assets/js/js-sound-success.mp3" preload="auto"></audio>
    <audio id="sound-error" src="https://cdn.jsdelivr.net/gh/ManzDev/cursos-assets/js/js-sound-error.mp3" preload="auto"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA OBJECTS ---
            const V20_DATA = { /* ... Contenido de V20_DATA aquí ... */
                clans: { assamita: { name: "Assamita", nickname: "Asesinos, Sarracenos", appearance: "Suelen tener rasgos de Oriente Medio, piel oscura y constitución atlética. Visten de forma funcional, aunque los más viejos pueden preferir ropajes tradicionales.", haven: "Prefieren refugios remotos y seguros, como fortalezas en el desierto o apartamentos discretos y bien protegidos en la ciudad, siempre con múltiples rutas de escape.", background: "Los Assamitas son un clan de asesinos y guerreros del Medio Oriente, conocidos por su búsqueda de la pureza a través de la diablerie y su maestría en el arte de matar. Operan con un estricto código de honor y ven el asesinato como un sacramento.", organization: "Estructura jerárquica y celular. Un líder, el 'Viejo de la Montaña', dirige desde su fortaleza en Alamut. Las misiones se asignan con precisión y secretismo.", weakness: "Aura reconocible para otros vampiros; Sufren un dado más de daño por fuego y luz solar; Adicción a la sangre de vampiro (diablerie) una vez probada.", disciplines: ["Extinción", "Ofuscación", "Celeridad"] }, brujah: { name: "Brujah", nickname: "Chusma, Filósofos Guerreros", appearance: "Cualquier estilo que grite rebelión y desafío: cuero, botas, crestas punk, ropa de protesta. Buscan impactar y proyectar una imagen de inconformismo.", haven: "Lugares comunales y a menudo desordenados: almacenes abandonados, locales de okupas, sótanos de bares punk o cualquier lugar donde puedan reunirse y debatir acaloradamente.", background: "Antaño filósofos y reyes guerreros, los Brujah modernos son vistos a menudo como una turba de rebeldes, anarquistas y agitadores. Poseen una pasión feroz por sus ideales, aunque a menudo están en desacuerdo sobre cuáles son, y son rápidos para la ira y la acción.", organization: "Anárquica en apariencia, pero a menudo se organizan en torno a líderes carismáticos o causas comunes. Valoran la libertad individual por encima de la estructura formal.", weakness: "Frenesí más fácil (-2 dificultad a resistir).", disciplines: ["Potencia", "Celeridad", "Presencia"] }, setita: { name: "Seguidores de Set", nickname: "Serpientes, Tentadores", appearance: "A menudo atractivos y con un aire exótico y seductor, con influencias egipcias o africanas. Visten para seducir y corromper, usando la moda como una herramienta más.", haven: "Templos ocultos dedicados a Set, fumaderos de opio, clubes nocturnos de mala muerte o apartamentos de lujo donde se celebran fiestas decadentes. Siempre lugares oscuros y llenos de secretos.", background: "Los Setitas, o Seguidores de Set, son corruptores y traficantes de secretos, fe y vicios. Adoran a su oscuro dios Set y buscan minar la sociedad mortal e inmortal desde dentro, creyendo que la entropía y la oscuridad son el estado natural del universo.", organization: "Cultista y jerárquica. Se organizan en templos liderados por un sumo sacerdote. La lealtad es al clan y a Set por encima de cualquier secta.", weakness: "Sufren dos niveles de salud de daño adicionales por la luz solar. Adictos a los vicios y placeres, penalización a resistir tentaciones.", disciplines: ["Serpentis", "Ofuscación", "Presencia"] }, gangrel: { name: "Gangrel", nickname: "Forasteros, Animales", appearance: "Aspecto rudo y funcional. Suelen tener cicatrices, tatuajes y rasgos que se van volviendo más animalescos con el tiempo. Su ropa está hecha para durar en la intemperie.", haven: "No suelen tener refugios permanentes. Duermen donde pueden, a menudo en parques, cuevas, cementerios o incluso fundiéndose con la tierra misma. Valoran la movilidad.", background: "Los Gangrel son nómadas y salvajes, más en sintonía con la Bestia Interior que la mayoría de los Vástagos. Son supervivientes y a menudo prefieren la compañía de animales a la de otros vampiros, desconfiando de la política de la Jyhad.", organization: "Totalmente individualistas. No tienen una organización formal. Se respetan las hazañas y la fuerza personal, y a veces se reúnen en 'círculos' o 'bandadas'.", weakness: "Ganan un rasgo animal (físico o de comportamiento) cada vez que entran en frenesí.", disciplines: ["Animalismo", "Fortaleza", "Protean"] }, giovanni: { name: "Giovanni", nickname: "Nigromantes, Usureros", appearance: "Conservadores y de aspecto adinerado, casi siempre de ascendencia italiana. Prefieren trajes caros y un aspecto impecable que proyecte poder y riqueza.", haven: "Mansiones familiares, mausoleos, funerarias o las sedes de sus corporaciones. Lugares que reflejen su riqueza y su conexión con la muerte.", background: "Una familia incestuosa de nigromantes y financistas italianos, los Giovanni valoran la riqueza, el poder y los secretos de la muerte por encima de todo. Su lealtad es primordialmente hacia la familia, no hacia la Camarilla o el Sabbat.", organization: "Estrictamente familiar y jerárquica. El cabeza de familia, el 'Anziano', dicta las reglas desde su base en Venecia. La traición se paga con la Muerte Final.", weakness: "Su mordisco causa un dolor insoportable (Beso de la Muerte). Solo pueden alimentarse de mortales; la sangre animal no les sustenta.", disciplines: ["Potencia", "Dominación", "Nigromancia"] }, lasombra: { name: "Lasombra", nickname: "Guardianes, Magisters", appearance: "Elegantes, impecables y a menudo con rasgos mediterráneos (españoles o italianos). Visten para impresionar y dominar, prefiriendo el negro y los colores oscuros.", haven: "Penthouses de lujo, mansiones sombrías, sedes corporativas o iglesias profanadas. Lugares que demuestren su poder y control.", background: "Elegantes y depredadores, los Lasombra son el corazón y el alma del Sabbat. Maestros de la intriga y las sombras, se ven a sí mismos como la cúspide de la evolución vampírica y a los demás como peones en su gran juego de poder eterno.", organization: "Meritocrática y despiadada. El poder se gana a través de la astucia y la fuerza. Respetan a aquellos que pueden tomar el poder y mantenerlo, sin importar los medios.", weakness: "No se reflejan (espejos, agua, cámaras, etc.). Sufren un nivel de daño agravado adicional por la luz solar.", disciplines: ["Dominación", "Obtenebración", "Potencia"] }, malkavian: { name: "Malkavian", nickname: "Lunáticos, Oráculos", appearance: "Su apariencia es impredecible y varía enormemente, reflejando su estado mental. Pueden ir desde impecables hasta completamente desaliñados, a menudo con un detalle extraño o fuera de lugar.", haven: "Hospitales psiquiátricos abandonados, apartamentos caóticos llenos de arte extraño, bibliotecas olvidadas o cualquier lugar que resuene con su percepción única de la realidad.", background: "Los Malkavian están todos irremediablemente locos, pero su locura a menudo les concede una extraña perspicacia, sabiduría y visiones proféticas. Su 'red de la demencia' los conecta de formas misteriosas, compartiendo ideas y visiones a través de la distancia.", organization: "Inexistente en la superficie, pero la Red de la Demencia les proporciona una extraña cohesión. A veces actúan al unísono sin una razón aparente para los extraños.", weakness: "Sufren un Trastorno Mental incurable desde el Abrazo.", disciplines: ["Auspex", "Dementación", "Ofuscación"] }, nosferatu: { name: "Nosferatu", nickname: "Ratas de Alcantarilla, Leprosos", appearance: "Horriblemente deformados, sin dos Nosferatu iguales en su fealdad. Son monstruosos hasta el punto de que no pueden interactuar con la sociedad mortal sin causar terror.", haven: "El subsuelo es su dominio: alcantarillas, túneles de metro abandonados, catacumbas y sótanos olvidados. Crean redes de túneles conocidas como 'madrigueras'.", background: "Horriblemente deformados por el Abrazo, los Nosferatu se ocultan en las sombras, convirtiéndose en maestros del sigilo, la información y los secretos urbanos. Venden información al mejor postor, lo que los hace indispensables y temidos.", organization: "Comunitaria y basada en la supervivencia. Se agrupan en 'crías' o 'nidadas' por protección mutua y comparten información para mantenerse a salvo de un mundo que los rechaza.", weakness: "Apariencia monstruosa (Apariencia 0).", disciplines: ["Animalismo", "Ofuscación", "Potencia"] }, ravnos: { name: "Ravnos", nickname: "Embaucadores, Gitanos", appearance: "A menudo con rasgos de Europa del Este o la India (romaníes). Su estilo es ecléctico y viajero, práctico pero con un toque de ostentación o desafío.", haven: "Campamentos de caravanas, moteles de carretera, coches robados, o cualquier lugar temporal que les permita moverse rápidamente. No se atan a un solo lugar.", background: "Viajeros, embaucadores y maestros de la ilusión, los Ravnos son un clan disperso, a menudo desconfiado por los demás Vástagos debido a su reputación de engaño y anarquía. Valoran la libertad y desafían las tradiciones de la Camarilla y el Sabbat.", organization: "Basada en la familia y la lealtad a pequeños grupos viajeros. Siguen un estricto código interno de conducta y hospitalidad, pero son ferozmente independientes.", weakness: "Adicción a un vicio específico (engaño, robo, juego, etc.) que deben satisfacer regularmente.", disciplines: ["Animalismo", "Fortaleza", "Quimerismo"] }, toreador: { name: "Toreador", nickname: "Artesanos, Degenerados", appearance: "La cúspide de la moda y la belleza. Siempre visten con las últimas tendencias o con un estilo clásico impecable. Su apariencia es una de sus principales armas.", haven: "Lofts de artistas, galerías de arte, teatros, apartamentos de diseño o cualquier lugar que sea estéticamente bello y esté en el centro de la escena cultural.", background: "Amantes de la belleza y el arte en todas sus formas, los Toreador son los diletantes y artistas del mundo vampírico. Se sienten atraídos por los mortales talentosos y las últimas tendencias, y a menudo son los vampiros más cercanos a la sociedad humana.", organization: "Redes sociales fluidas y salones. Su estatus se basa en su influencia cultural, su gusto y su popularidad. Las fiestas y las exposiciones son sus campos de batalla.", weakness: "Fascinación por la belleza; pueden quedar absortos (-1 a las tiradas) ante algo o alguien hermoso, a discreción del Narrador.", disciplines: ["Auspex", "Celeridad", "Presencia"] }, tremere: { name: "Tremere", nickname: "Brujos, Usurpadores", appearance: "Conservadores y a menudo con un aire académico o severo. Suelen vestir de forma formal o con túnicas rituales en sus capillas. Suelen llevar un símbolo del clan.", haven: "Capillas fuertemente protegidas, a menudo en universidades, bibliotecas antiguas o edificios históricos. Sus refugios son laboratorios y fortalezas arcanas.", background: "Un clan de hechiceros de la sangre, los Tremere son disciplinados, jerárquicos y a menudo temidos por su poder taumatúrgico. Nacieron de magos mortales que robaron la inmortalidad, y su estructura piramidal exige una estricta lealtad.", organization: "Estricta pirámide de poder. La lealtad se jura hacia arriba, desde el aprendiz hasta el regente de la capilla, y en última instancia al Consejo de los Siete en Viena.", weakness: "Juramento de Sangre al Consejo de los Siete (un paso hacia el vínculo con cada uno de los siete que componen su círculo interno). Deben beber sangre de otros Tremere al ser Abrazados.", disciplines: ["Auspex", "Dominación", "Taumaturgia"] }, tzimisce: { name: "Tzimisce", nickname: "Demonios, Voivodas", appearance: "Pueden tener cualquier apariencia que deseen gracias a Vicisitud. Muchos adoptan formas aterradoras o inhumanas para distanciarse de la 'arcilla mortal'. Otros mantienen una apariencia aristocrática del Viejo Mundo.", haven: "Ancestrales castillos, mansiones apartadas, o laboratorios médicos. Siempre están ligados a su tierra y necesitan dormir cerca de ella.", background: "Territoriales, eruditos y a menudo inhumanos, los Tzimisce son los 'demonios' del Viejo Mundo, maestros de la carne y el hueso a través de su Disciplina Vicisitud. Ven a los demás como materia prima para sus experimentos y arte.", organization: "Feudal y solitaria. Respetan el protocolo y la hospitalidad, pero cada Tzimisce es el señor absoluto de su dominio. La lealtad es a sí mismos primero.", weakness: "Deben dormir cerca de al menos dos puñados de tierra de un lugar importante para ellos (generalmente su lugar de nacimiento o muerte como mortal).", disciplines: ["Animalismo", "Auspex", "Vicisitud"] }, ventrue: { name: "Ventrue", nickname: "Sangre Azul, Patricios", appearance: "Impecables, conservadores y caros. Prefieren la ropa de alta costura y de negocios que proyecta autoridad y éxito. La apariencia de poder es fundamental.", haven: "Penthouses ejecutivos, mansiones en barrios ricos, clubes de élite. Lugares que reflejen su estatus y control sobre el mundo mortal.", background: "Los 'Sangre Azul' de los Vástagos, los Ventrue se ven a sí mismos como los líderes natos de la sociedad vampírica. Valoran la tradición, el poder y la influencia, y a menudo ocupan posiciones de liderazgo en la Camarilla.", organization: "Corporativa y aristocrática. Se organizan en juntas directivas y linajes. El estatus se gana a través de la riqueza, la influencia y el linaje. Valoran el orden y la estabilidad.", weakness: "Restricción alimentaria selectiva (solo pueden alimentarse de un tipo específico de sangre mortal, ej: 'solo rubias', 'solo clérigos').", disciplines: ["Dominación", "Fortaleza", "Presencia"] }, caitiff: { name: "Caitiff", nickname: "Sin Clan, Basura", appearance: "Tan variada como la humanidad. No tienen un aspecto definido, a menudo adoptan estilos que les permiten mezclarse o que reflejan su vida en los márgenes de la sociedad.", haven: "Cualquier lugar donde puedan pasar desapercibidos. Apartamentos baratos, refugios para desamparados, alcantarillas... son los supervivientes definitivos.", background: "Los sin clan, los Caitiff no muestran las características ni las debilidades de un clan en particular. Son los parias de la sociedad vampírica, a menudo despreciados y desconfiados por todos. Su no-vida es una lucha constante por la supervivencia y la identidad.", organization: "Ninguna. Son completamente individualistas, aunque a veces forman pequeñas bandas o se aferran a otros marginados por protección mutua.", weakness: "Coste de PX para nuevas Disciplinas x6 (en lugar de x5). Marginados sociales, a menudo con dificultad para ganar Posición.", disciplines: ["Ninguna como clan. Eligen al ser creados."] }
                },
                disciplines_info: { "Animalismo": "Permite comunicarse y controlar a los animales, e incluso invocar a la Bestia interior.", "Auspex": "Concede sentidos sobrenaturales, percepción extrasensorial y la capacidad de leer auras y mentes.", "Celeridad": "Otorga una velocidad y reflejos sobrehumanos, permitiendo acciones múltiples en un instante.", "Dementación": "Permite proyectar la propia locura en otros, causando confusión, visiones y terror.", "Dominación": "Controla la mente de otros mediante el contacto visual y órdenes directas.", "Extinción": "Disciplina de los Assamitas que les permite manipular la sangre y silenciar a sus víctimas.", "Fortaleza": "Proporciona una resistencia y dureza sobrenaturales, permitiendo ignorar heridas.", "Nigromancia": "El arte de comunicarse y comandar a los muertos y los espíritus del inframundo.", "Obtenebración": "Permite manipular y controlar las sombras y la oscuridad misma.", "Ofuscación": "La capacidad de volverse invisible y ocultar la presencia a los demás sentidos.", "Potencia": "Otorga una fuerza física increíble, muy por encima de los límites mortales.", "Presencia": "Permite atraer, influir y dominar las emociones de los demás sin decir una palabra.", "Protean": "La capacidad de cambiar de forma, desde hacer crecer garras hasta transformarse en animal o niebla.", "Quimerismo": "Crea ilusiones tan reales que pueden engañar a todos los sentidos e incluso causar daño.", "Serpentis": "Disciplina de los Setitas que les otorga poderes reptilianos, como una lengua bífida o escamas.", "Taumaturgia": "La hechicería de la sangre, una forma rígida y poderosa de magia vampírica.", "Vicisitud": "El terrible poder de moldear la carne y el hueso, tanto el propio como el de otros." }
            };

            // --- Contenedores Principales ---
            const dossierWrapper = document.getElementById('dossier-wrapper');
            const terminalVWrapper = document.getElementById('terminal-v-wrapper');
            const bestiaryWrapper = document.getElementById('bestiary-wrapper');

            // --- Dossier: Controles ---
            const dossierAccessCodeInput = document.getElementById('dossier-access-code-input');
            const dossierVerifyCodeBtn = document.getElementById('dossier-verify-code-btn');
            const missionDetailsContainer = document.getElementById('mission-details-container');
            const dossierErrorMessageEl = document.getElementById('dossier-error-message');
            const dossierHoursEl = document.getElementById('dossier-hours');
            const dossierMinutesEl = document.getElementById('dossier-minutes');
            const dossierSecondsEl = document.getElementById('dossier-seconds');
            const DOSSIER_CORRECT_ACCESS_CODE = "2 de Tamuz 5785";
            const DOSSIER_TARGET_DATE_TIMESTAMP = new Date(2025, 5, 28, 0, 0, 0).getTime();
            let dossierPuzzleCountdownInterval;
            let dossierGlitchTimeout;
            
            // --- Terminal V: Controles ---
            const terminalVVerifyDateBtn = document.getElementById('terminal-v-verify-date-btn');
            const terminalVMessageFeedbackEl = document.getElementById('terminal-v-message-feedback');
            const binaryOutputContainerEl = document.getElementById('binary-output-container');
            const binaryCodeContentEl = document.getElementById('binary-code-content');
            const binaryOutputTitleEl = document.getElementById('binary-output-title');
            const terminalVDateInputs = Array.from(document.querySelectorAll('#numeric-date-inputs .date-char-input'));
            const TERMINAL_V_TARGET_NUMERIC_DATE = "28062025";
            const TERMINAL_V_MESSAGE_TO_ENCODE = "Eligio Ancona 106 Santa María la Ribera V:";
            let terminalVGlitchTimeout;

            // --- Bestiario: Controles ---
            const clanGrid = document.getElementById('clan-grid');
            const modal = document.getElementById('clan-modal');
            const modalClanName = document.getElementById('modal-clan-name');
            const modalClanNickname = document.getElementById('modal-clan-nickname');
            const modalClanAppearance = document.getElementById('modal-clan-appearance');
            const modalClanSightingPoints = document.getElementById('modal-clan-sighting-points');
            const modalClanOrganization = document.getElementById('modal-clan-organization');
            const modalClanBackground = document.getElementById('modal-clan-background');
            const modalClanDisciplines = document.getElementById('modal-clan-disciplines');
            const modalClanWeakness = document.getElementById('modal-clan-weakness');
            const closeModalBtn = document.getElementById('modal-close-btn');
            const tooltip = document.getElementById('discipline-tooltip');

            // --- Botones de Navegación ---
            const proceedToTerminalVBtn = document.getElementById('proceed-to-terminal-v-btn');
            const proceedToBestiaryBtn = document.getElementById('proceed-to-bestiary-btn');
            const returnToDossierBtn = document.getElementById('return-to-dossier-btn');
            const returnToDossierFromBestiaryBtn = document.getElementById('return-to-dossier-from-bestiary-btn');

            // --- Sonidos (compartidos) ---
            const soundClick = document.getElementById('sound-click');
            const soundSuccess = document.getElementById('sound-success');
            const soundError = document.getElementById('sound-error');

            function playSound(soundElement) {
                if (soundElement) {
                    soundElement.currentTime = 0;
                    soundElement.play().catch(e => console.warn("Error al reproducir sonido:", e.message));
                }
            }

            // --- Lógica de Navegación ---
            function showSection(sectionToShow) {
                playSound(soundClick);
                dossierWrapper.classList.add('hidden-section');
                terminalVWrapper.classList.add('hidden-section');
                bestiaryWrapper.classList.add('hidden-section');
                
                sectionToShow.classList.remove('hidden-section');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            proceedToTerminalVBtn.addEventListener('click', () => showSection(terminalVWrapper));
            proceedToBestiaryBtn.addEventListener('click', () => showSection(bestiaryWrapper));
            returnToDossierBtn.addEventListener('click', () => showSection(dossierWrapper));
            returnToDossierFromBestiaryBtn.addEventListener('click', () => showSection(dossierWrapper));


            // --- Lógica para el Dossier "Diluvio Escarlata" ---
            function normalizeDossierString(str) {
                return str.toLowerCase().replace(/\s+de\s+/g, ' ').replace(/\s+/g, ' ').trim();
            }

            dossierVerifyCodeBtn.addEventListener('click', () => {
                playSound(soundClick);
                const userInput = normalizeDossierString(dossierAccessCodeInput.value);
                const normalizedCorrectCode = normalizeDossierString(DOSSIER_CORRECT_ACCESS_CODE);
                dossierErrorMessageEl.textContent = ''; 
                dossierErrorMessageEl.classList.remove('input-error-glitch'); 
                clearTimeout(dossierGlitchTimeout);

                if (userInput === normalizedCorrectCode) {
                    missionDetailsContainer.classList.add('visible');
                    dossierAccessCodeInput.disabled = true;
                    dossierVerifyCodeBtn.disabled = true;
                    dossierAccessCodeInput.classList.add('opacity-50');
                    dossierVerifyCodeBtn.classList.add('opacity-50');
                    dossierErrorMessageEl.textContent = 'ACCESO CONCEDIDO. DATOS DE MISIÓN DESBLOQUEADOS.';
                    dossierErrorMessageEl.classList.remove('text-red-500');
                    dossierErrorMessageEl.classList.add('text-green-400');
                    playSound(soundSuccess);
                } else {
                    dossierErrorMessageEl.textContent = 'CÓDIGO INCORRECTO. ACCESO DENEGADO.';
                    dossierErrorMessageEl.classList.remove('text-green-400');
                    dossierErrorMessageEl.classList.add('text-red-500', 'input-error-glitch');
                    missionDetailsContainer.classList.remove('visible');
                    playSound(soundError);
                    dossierGlitchTimeout = setTimeout(() => dossierErrorMessageEl.classList.remove('input-error-glitch'), 500); 
                }
            });

            function updateDossierPuzzleCountdown() {
                const now = new Date().getTime();
                const distance = DOSSIER_TARGET_DATE_TIMESTAMP - now;
                if (distance < 0) {
                    clearInterval(dossierPuzzleCountdownInterval);
                    const countdownTimerEl = document.getElementById('puzzle-countdown-timer');
                    if (countdownTimerEl) countdownTimerEl.innerHTML = "<p class='text-2xl text-red-500'>TIEMPO EXPIRADO. EVENTO EN CURSO.</p>";
                    return;
                }
                const totalSecondsRemaining = Math.floor(distance / 1000);
                const hours = Math.floor(totalSecondsRemaining / 3600);
                const minutes = Math.floor((totalSecondsRemaining % 3600) / 60);
                const seconds = totalSecondsRemaining % 60;
                if(dossierHoursEl) dossierHoursEl.textContent = String(hours).padStart(2, '0');
                if(dossierMinutesEl) dossierMinutesEl.textContent = String(minutes).padStart(2, '0');
                if(dossierSecondsEl) dossierSecondsEl.textContent = String(seconds).padStart(2, '0');
            }
            if(dossierHoursEl) {
                 updateDossierPuzzleCountdown();
                 dossierPuzzleCountdownInterval = setInterval(updateDossierPuzzleCountdown, 1000); 
            }

            // --- Lógica para la "Terminal de Datos V" ---
            terminalVDateInputs.forEach((input, index) => {
                input.addEventListener('input', (e) => {
                    if (!/^\d?$/.test(e.target.value)) { e.target.value = ''; return; }
                    if (e.target.value.length > 1) { e.target.value = e.target.value.slice(0, 1); }
                    if (e.target.value.length === 1 && index < terminalVDateInputs.length - 1) {
                        terminalVDateInputs[index + 1].focus();
                    }
                });
                input.addEventListener('keydown', (e) => {
                    if (!((e.keyCode >= 48 && e.keyCode <= 57) || (e.keyCode >= 96 && e.keyCode <= 105) || ['Backspace', 'Delete', 'Tab'].includes(e.key) || e.key.startsWith('Arrow'))) {
                        e.preventDefault();
                    }
                    if (e.key === 'Backspace' && e.target.value.length === 0 && index > 0) {
                        terminalVDateInputs[index - 1].focus();
                    }
                });
            });

            function constructNumericDateFromTerminalVInputs(inputsArr) {
                return inputsArr.map(input => input.value).join('');
            }

            function stringToBinaryForTerminalV(str) { 
                return str.split('').map(char => char.charCodeAt(0).toString(2).padStart(8, '0')).join(' ');
            }

            function disableTerminalVInputs() {
                terminalVDateInputs.forEach(input => { input.disabled = true; input.classList.add('opacity-50'); });
                terminalVVerifyDateBtn.disabled = true; terminalVVerifyDateBtn.classList.add('opacity-50');
            }

            terminalVVerifyDateBtn.addEventListener('click', () => {
                playSound(soundClick);
                const userInputDate = constructNumericDateFromTerminalVInputs(terminalVDateInputs);
                terminalVMessageFeedbackEl.textContent = '';
                terminalVMessageFeedbackEl.classList.remove('input-error-glitch', 'text-green-400', 'text-red-500');
                binaryOutputContainerEl.classList.remove('glitch-active-area');
                binaryOutputTitleEl.textContent = "[INICIO DE TRANSMISIÓN // REGISTRO 02 T]";
                clearTimeout(terminalVGlitchTimeout);

                if (userInputDate === TERMINAL_V_TARGET_NUMERIC_DATE) {
                    terminalVMessageFeedbackEl.textContent = 'SECUENCIA CORRECTA. INICIANDO DECODIFICACIÓN...';
                    terminalVMessageFeedbackEl.classList.add('text-green-400');
                    playSound(soundSuccess);
                    const binaryResult = stringToBinaryForTerminalV(TERMINAL_V_MESSAGE_TO_ENCODE); 
                    binaryCodeContentEl.textContent = binaryResult;
                    binaryOutputContainerEl.style.display = 'block';
                    binaryOutputContainerEl.classList.add('glitch-active-area'); 
                    disableTerminalVInputs();
                } else {
                    terminalVMessageFeedbackEl.textContent = 'ERROR: SECUENCIA INCORRECTA. ACCESO DENEGADO.';
                    terminalVMessageFeedbackEl.classList.add('text-red-500', 'input-error-glitch'); 
                    binaryOutputContainerEl.style.display = 'none';
                    binaryCodeContentEl.textContent = '';
                    playSound(soundError);
                    terminalVGlitchTimeout = setTimeout(() => terminalVMessageFeedbackEl.classList.remove('input-error-glitch'), 500);
                }
            });

            // --- Lógica para el Bestiario ---
            for (const clanId in V20_DATA.clans) {
                const clan = V20_DATA.clans[clanId];
                const gridItem = document.createElement('div');
                gridItem.className = 'clan-grid-item';
                gridItem.textContent = clan.name;
                gridItem.dataset.clanId = clanId;
                gridItem.addEventListener('click', () => openModal(clanId));
                clanGrid.appendChild(gridItem);
            }

            function openModal(clanId) {
                const clan = V20_DATA.clans[clanId];
                if (!clan) return;
                modalClanName.textContent = `[ ${clan.name.toUpperCase()} ]`;
                modalClanNickname.textContent = clan.nickname || "N/A";
                modalClanAppearance.textContent = clan.appearance || "N/A";
                modalClanSightingPoints.textContent = clan.haven || "N/A"; 
                modalClanOrganization.textContent = clan.organization || "N/A";
                modalClanBackground.textContent = clan.background;
                modalClanWeakness.textContent = clan.weakness;
                modalClanDisciplines.innerHTML = '';
                clan.disciplines.forEach(discName => {
                    const discButton = document.createElement('button');
                    discButton.className = 'discipline-btn';
                    discButton.textContent = discName;
                    discButton.dataset.discipline = discName;
                    discButton.addEventListener('click', (e) => { e.stopPropagation(); showDisciplineTooltip(e, discName); });
                    modalClanDisciplines.appendChild(discButton);
                });
                modal.classList.add('active');
            }

            function showDisciplineTooltip(event, discName) {
                const info = V20_DATA.disciplines_info[discName];
                if (!info) return;
                tooltip.textContent = info;
                tooltip.style.display = 'block';
                const rect = event.target.getBoundingClientRect();
                let top = rect.bottom + 5;
                let left = rect.left;
                if (top + tooltip.offsetHeight > window.innerHeight) { top = rect.top - tooltip.offsetHeight - 5; }
                if (left + tooltip.offsetWidth > window.innerWidth) { left = window.innerWidth - tooltip.offsetWidth - 10; }
                tooltip.style.top = `${top}px`;
                tooltip.style.left = `${left}px`;
            }

            function hideTooltip() { tooltip.style.display = 'none'; }
            function closeModal() { modal.classList.remove('active'); hideTooltip(); }

            closeModalBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (event) => {
                if (event.target === modal) { closeModal(); } 
                else if (!event.target.classList.contains('discipline-btn')) { hideTooltip(); }
            });
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape' && modal.classList.contains('active')) { closeModal(); }
            });
        });
    </script>
</body>
</html>
